# Milestone v2.1: Continuous Cloud Recording

**Status:** ✅ SHIPPED 2026-01-21
**Phases:** 7-9
**Total Plans:** 7

## Overview

Continuous background recording with secure cloud uploads (Cloudflare R2), efficient video format (WebM/VP9), and graceful page refresh handling. Manual recording coexists without interference.

## Phases

### Phase 7: Storage Migration

**Goal**: Replace S3 with secure Cloudflare R2 using presigned URLs (credentials stay server-side)
**Depends on**: Phase 6 (S3 Upload foundation)
**Plans**: 3 plans

Plans:
- [x] 07-01: Backend + Types Foundation (Pages Function, cloud types)
- [x] 07-02: Upload Infrastructure (cloudUpload utility, useCloudUpload hook)
- [x] 07-03: UI Integration (CloudConfigModal, wire into existing components)

### Phase 8: Continuous Recording

**Goal**: Background MediaRecorder with chunked uploads, page unload handling, efficient format (WebM/VP9)
**Depends on**: Phase 7
**Plans**: 3 plans

Plans:
- [x] 08-01: Chunk Storage Infrastructure (types, chunkStorage.ts)
- [x] 08-02: useContinuousRecording Hook (MediaRecorder, visibilitychange, upload)
- [x] 08-03: UI Integration (toggle button, status indicator, human verification)

### Phase 9: Dual Recording Mode

**Goal**: Manual record button for local clips with optional upload, independent from background stream
**Depends on**: Phase 8
**Plans**: 1 plan

Plans:
- [x] 09-01: Add direct upload button for manual recordings

---

## Milestone Summary

**Key Decisions:**
- aws4fetch for presigned URL generation in Cloudflare Workers (AWS SDK v3 not compatible)
- CloudConfig only has 'enabled' boolean - no credentials stored client-side
- Separate IndexedDB database for chunks (formcheck-chunks) from recordings
- 5-second timeslice for continuous recording chunks
- visibilitychange is ONLY page exit signal used (no beforeunload)
- Purple/violet color scheme for Upload button to distinguish from Download (blue) and Save (green)

**Issues Resolved:**
- S3 credential exposure risk → presigned URLs with server-side credentials
- Memory accumulation during long recordings → progressive chunk saving to IndexedDB
- Page exit data loss → visibilitychange handling with auto-upload

**Issues Deferred:**
- None

**Technical Debt Incurred:**
- Old S3ConfigModal.tsx kept for reference but no longer imported

---

_For current project status, see .planning/ROADMAP.md_
