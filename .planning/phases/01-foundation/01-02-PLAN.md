---
phase: 01-foundation
plan: 02
type: execute
wave: 2
depends_on: ["01-01"]
files_modified: [src/components/CameraPreview.tsx, src/hooks/useCamera.ts, src/App.tsx]
autonomous: true
---

<objective>
Implement camera access with live video preview and camera switching.

Purpose: Enable users to see themselves in real-time, the foundation for pose detection.
Output: Working camera preview with permission handling and front/back camera toggle on mobile.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation/01-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create useCamera hook</name>
  <files>src/hooks/useCamera.ts</files>
  <action>
    Create custom hook that:
    1. Manages camera stream state (stream, error, loading)
    2. Requests camera access via navigator.mediaDevices.getUserMedia()
    3. Handles permission denied gracefully with clear error state
    4. Supports facingMode toggle ("user" for front, "environment" for back)
    5. Cleans up stream on unmount (stop all tracks)
    6. Exposes: stream, error, isLoading, toggleCamera, videoRef

    Use constraints: { video: { facingMode: currentFacing, width: { ideal: 1280 }, height: { ideal: 720 } } }

    Handle errors: NotAllowedError (permission denied), NotFoundError (no camera), other (generic).
  </action>
  <verify>Hook compiles without TypeScript errors</verify>
  <done>useCamera hook exports stream management functions</done>
</task>

<task type="auto">
  <name>Task 2: Create CameraPreview component</name>
  <files>src/components/CameraPreview.tsx</files>
  <action>
    Create component that:
    1. Uses useCamera hook
    2. Renders video element with autoPlay, playsInline, muted attributes
    3. Sets video.srcObject to stream when available
    4. Shows loading spinner while requesting permission
    5. Shows friendly error message if permission denied ("Please allow camera access to use FormCheck")
    6. Shows camera switch button (visible only on touch devices or always for testing)
    7. Mirror the video horizontally with CSS transform (scaleX(-1)) for front camera

    Styling:
    - Video fills container, object-fit: cover
    - Rounded corners
    - Camera switch button in bottom-right corner
  </action>
  <verify>Component renders without errors, shows video when permission granted</verify>
  <done>CameraPreview displays live video with switch button</done>
</task>

<task type="auto">
  <name>Task 3: Integrate camera into App</name>
  <files>src/App.tsx</files>
  <action>
    Update App.tsx to:
    1. Import and render CameraPreview component
    2. Center the camera preview in the viewport
    3. Add "FormCheck" header above video
    4. Keep dark theme styling

    Layout: Full height container, header at top, camera preview taking most of the space.
  </action>
  <verify>npm run dev shows live camera feed with header and switch button</verify>
  <done>Camera preview visible and functional in app</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run dev` shows camera permission prompt
- [ ] After granting permission, live video appears
- [ ] Camera switch button toggles between front/back (on mobile or simulated)
- [ ] Permission denied shows friendly error message
- [ ] No console errors or TypeScript issues
</verification>

<success_criteria>
- All tasks completed
- Camera preview works on desktop (webcam)
- Camera switching logic implemented (testable on mobile)
- Permission UX is friendly and clear
- Requirements CAM-01 and CAM-02 satisfied
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation/01-02-SUMMARY.md`
</output>
