---
phase: 03-recording
plan: 01
type: execute
wave: 1
depends_on: []
files_modified: [src/hooks/useRecording.ts, src/components/CameraPreview.tsx, src/types/recording.ts]
autonomous: true
---

<objective>
Integrate MediaRecorder API with start/stop recording controls on the camera preview.

Purpose: Enable users to capture their workout sessions as video files for later review.
Output: Working record/stop button that captures video from camera stream.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

@src/hooks/useCamera.ts
@src/components/CameraPreview.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create recording types and useRecording hook</name>
  <files>src/types/recording.ts, src/hooks/useRecording.ts</files>
  <action>
    1. Create src/types/recording.ts with:
       - `RecordingState` type: 'idle' | 'recording' | 'stopped'
       - `Recording` interface: { blob: Blob, url: string, timestamp: Date, duration: number }

    2. Create src/hooks/useRecording.ts:
       - Accept MediaStream as parameter
       - Use MediaRecorder API with 'video/webm' MIME type (fallback to 'video/mp4' if not supported)
       - Track recording state: idle → recording → stopped
       - Collect chunks via ondataavailable (timeslice: 1000ms for periodic chunks)
       - On stop: create Blob from chunks, generate object URL
       - Track recording duration with setInterval (update every second)
       - Return: { state, recording, duration, startRecording, stopRecording }
       - Clean up object URLs when hook unmounts to prevent memory leaks

    Note: Do NOT record the pose overlay - just the raw camera feed. The user wants clean recordings.
  </action>
  <verify>TypeScript compiles without errors: `npm run build`</verify>
  <done>useRecording hook exports and types compile correctly</done>
</task>

<task type="auto">
  <name>Task 2: Add recording controls to CameraPreview</name>
  <files>src/components/CameraPreview.tsx</files>
  <action>
    1. Import useRecording hook and pass stream to it
    2. Add recording control button:
       - Position: bottom-left (opposite of camera switch button)
       - Style: Same pill style as camera switch (bg-gray-800/80, 48px touch target)
       - Recording state visual:
         - Idle: White circle icon (ready to record)
         - Recording: Red pulsing circle with duration display (e.g., "0:45")
         - Stopped: Checkmark or download icon
    3. Button behavior:
       - Idle → click → startRecording()
       - Recording → click → stopRecording()
    4. Add recording indicator at top-right:
       - Show "REC" with red dot when recording
       - Show elapsed time (MM:SS format)

    Follow existing button styling patterns from camera switch button.
    Use Tailwind animate-pulse for recording indicator.
  </action>
  <verify>
    - `npm run build` succeeds
    - `npm run dev` shows record button in preview
  </verify>
  <done>Record/stop button visible and functional in camera preview</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` succeeds without errors
- [ ] Recording button appears in camera preview
- [ ] Click button starts recording (shows recording indicator)
- [ ] Click again stops recording (creates blob)
- [ ] No TypeScript errors
</verification>

<success_criteria>

- All tasks completed
- useRecording hook manages MediaRecorder lifecycle
- UI shows recording state clearly
- Duration displays during recording
- No memory leaks (object URLs cleaned up)
  </success_criteria>

<output>
After completion, create `.planning/phases/03-recording/03-01-SUMMARY.md`
</output>
