---
phase: 03-recording
plan: 02
type: execute
wave: 2
depends_on: ["03-01"]
files_modified: [src/components/CameraPreview.tsx, src/components/RecordingControls.tsx]
autonomous: true
---

<objective>
Add download functionality so users can save recorded videos to their device.

Purpose: Complete the recording workflow by letting users export their workout videos.
Output: Download button that saves recorded video as .webm file.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-recording/03-01-SUMMARY.md

@src/hooks/useRecording.ts
@src/types/recording.ts
@src/components/CameraPreview.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Extract recording controls to dedicated component</name>
  <files>src/components/RecordingControls.tsx, src/components/CameraPreview.tsx</files>
  <action>
    1. Create src/components/RecordingControls.tsx:
       - Accept props: { stream, recording, state, duration, onStart, onStop }
       - Move recording button and indicator from CameraPreview
       - Cleaner separation of concerns

    2. Update CameraPreview to use RecordingControls component
       - Pass useRecording state and handlers
       - Keep layout positioning in parent

    This refactor prepares for adding download button without cluttering CameraPreview.
  </action>
  <verify>`npm run build` succeeds, recording still works</verify>
  <done>RecordingControls component extracted and functional</done>
</task>

<task type="auto">
  <name>Task 2: Add download button and functionality</name>
  <files>src/components/RecordingControls.tsx</files>
  <action>
    1. Add download button that appears when recording.blob exists:
       - Position: Next to record button (horizontal row)
       - Icon: Download arrow
       - Style: Same as other control buttons

    2. Download implementation:
       - Create anchor element programmatically
       - Set href to recording.url (object URL from blob)
       - Set download attribute to filename: `formcheck-{timestamp}.webm`
       - Timestamp format: YYYY-MM-DD-HHmmss
       - Click anchor to trigger download
       - Clean up anchor after

    3. After download completes (or on new recording start):
       - Optionally show brief "Downloaded!" feedback
       - Reset recording state to idle for next recording

    4. Add "New Recording" button when in stopped state:
       - Clears current recording
       - Returns to idle state ready to record again
  </action>
  <verify>
    - `npm run build` succeeds
    - Record video → Stop → Download button appears → Click downloads file
    - File opens in video player
  </verify>
  <done>Users can download recorded videos as .webm files</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` succeeds without errors
- [ ] Full workflow: Record → Stop → Download → File saves
- [ ] Downloaded file plays correctly in video player
- [ ] Can start new recording after download
- [ ] No TypeScript errors
</verification>

<success_criteria>

- All tasks completed
- Download triggers browser file save
- Filename includes timestamp for organization
- Can record multiple videos in sequence
- Clean UI state transitions (record → stop → download → new)
  </success_criteria>

<output>
After completion, create `.planning/phases/03-recording/03-02-SUMMARY.md`
</output>
