---
phase: 06-s3-upload
plan: 02
type: execute
wave: 2
depends_on: ["06-01"]
files_modified: [src/components/RecordingList.tsx, src/components/S3ConfigModal.tsx, src/App.tsx]
autonomous: false
---

<objective>
Integrate S3 upload into the UI with config modal, upload buttons, and progress indicators.

Purpose: Allow users to configure S3 credentials and upload recordings with visual feedback.
Output: S3 config modal, upload buttons in recording list, progress/status indicators.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
@~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

@.planning/phases/06-s3-upload/06-01-SUMMARY.md

@src/types/s3.ts
@src/hooks/useS3Upload.ts
@src/components/RecordingList.tsx
@src/App.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create S3 config modal component</name>
  <files>src/components/S3ConfigModal.tsx</files>
  <action>
Create `src/components/S3ConfigModal.tsx`:

Props:
- isOpen: boolean
- onClose: () => void
- config: S3Config | null
- onSave: (config: S3Config) => void
- onClear: () => void

UI structure:
- Modal overlay (same pattern as RecordingList modal)
- Form with 4 inputs: Bucket Name, Region, Access Key ID, Secret Access Key
- Pre-fill from config prop if exists
- "Save" button saves config and closes
- "Clear Config" button (only if config exists) clears and closes
- "Cancel" button closes without saving
- Input validation: all fields required

Use Tailwind classes matching existing modal styles:
- Dark overlay with click-to-close
- White modal card with rounded corners
- Input styling consistent with app
- Buttons: primary (blue) for Save, secondary (gray) for Cancel, danger (red) for Clear

Security note: Show warning text that credentials are stored in browser localStorage
  </action>
  <verify>npm run build passes</verify>
  <done>S3ConfigModal renders form with all fields and buttons</done>
</task>

<task type="auto">
  <name>Task 2: Add upload functionality to RecordingList</name>
  <files>src/components/RecordingList.tsx</files>
  <action>
Modify RecordingList.tsx to add S3 upload support:

1. Add props to component:
   - s3Config: S3Config | null
   - uploads: UploadItem[]
   - onUpload: (recording: StoredRecording) => void
   - onRetry: (id: number, recording: StoredRecording) => void
   - onConfigClick: () => void

2. Add "Configure S3" button in header area:
   - Shows gear icon or "Configure S3" text
   - Calls onConfigClick when clicked
   - Show green checkmark if s3Config exists

3. For each recording item, add upload UI:
   - If no s3Config: show disabled "Upload" button with tooltip "Configure S3 first"
   - If s3Config exists:
     - Find upload status from uploads array by recording.id
     - No upload yet: show "Upload" button (cloud upload icon)
     - Status 'pending'/'uploading': show progress bar with percentage
     - Status 'complete': show green checkmark "Uploaded"
     - Status 'failed': show red X with "Retry" button

Progress bar: thin bar below recording info, width based on progress.percentage

4. Keep existing delete functionality intact
  </action>
  <verify>npm run build passes</verify>
  <done>RecordingList shows upload buttons and progress for each recording</done>
</task>

<task type="auto">
  <name>Task 3: Wire up S3 upload in App.tsx</name>
  <files>src/App.tsx</files>
  <action>
Modify App.tsx to integrate S3 upload:

1. Import useS3Upload hook and S3ConfigModal component

2. Add state for S3 config modal:
   - isS3ConfigOpen: boolean

3. Call useS3Upload hook:
   - const { config, isConfigured, saveConfig, clearConfig, uploads, uploadRecording, retryUpload } = useS3Upload()

4. Add S3ConfigModal to JSX:
   - Pass isOpen={isS3ConfigOpen}, onClose, config, onSave={saveConfig}, onClear={clearConfig}

5. Update RecordingList props:
   - s3Config={config}
   - uploads={uploads}
   - onUpload={(rec) => uploadRecording(rec)}
   - onRetry={(id, rec) => retryUpload(id, rec)}
   - onConfigClick={() => setIsS3ConfigOpen(true)}
  </action>
  <verify>npm run build passes</verify>
  <done>S3 upload fully wired up in app</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>S3 upload UI with config modal, upload buttons, and progress indicators</what-built>
  <how-to-verify>
    1. Run: npm run dev
    2. Visit: http://localhost:5173
    3. Navigate to recording history (if you have saved recordings)
    4. Look for "Configure S3" button - click it
    5. Verify modal opens with 4 input fields (Bucket, Region, Access Key ID, Secret Access Key)
    6. Verify form validation (try submitting empty)
    7. Close modal with Cancel or click outside
    8. Verify Upload buttons appear (disabled without S3 config)

    NOTE: Actual upload testing requires a real S3 bucket with CORS configured.
    The visual UI and form flow is what needs verification here.
  </how-to-verify>
  <resume-signal>Type "approved" if UI looks correct, or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` succeeds without errors
- [ ] S3ConfigModal displays and functions correctly
- [ ] Upload buttons appear in RecordingList
- [ ] Progress indicators show for uploads
- [ ] Config persistence works (reload page, config remains)
</verification>

<success_criteria>

- All tasks completed
- S3 config modal works with save/clear
- Upload buttons show appropriate state per recording
- Progress bars display during upload
- Retry functionality available for failed uploads
- Human verified UI is correct
</success_criteria>

<output>
After completion, create `.planning/phases/06-s3-upload/06-02-SUMMARY.md`
</output>
