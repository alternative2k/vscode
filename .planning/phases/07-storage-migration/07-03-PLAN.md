---
phase: 07-storage-migration
plan: 03
type: execute
wave: 3
depends_on: ["07-02"]
files_modified:
  - src/components/CloudConfigModal.tsx
  - src/components/CameraPreview.tsx
  - src/components/RecordingList.tsx
autonomous: false
---

<objective>
Create the UI components and wire everything together for cloud uploads.

Purpose: Replace S3ConfigModal with simpler CloudConfigModal (just enable/disable toggle), and update CameraPreview and RecordingList to use the new cloud upload system.

Output: Working cloud upload UI with human-verified functionality.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
@~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/07-storage-migration/07-RESEARCH.md
@.planning/phases/07-storage-migration/07-02-SUMMARY.md

# Existing S3 UI to replace:
@src/components/S3ConfigModal.tsx
@src/components/CameraPreview.tsx
@src/components/RecordingList.tsx

# New cloud upload system:
@src/hooks/useCloudUpload.ts
@src/types/cloud.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create CloudConfigModal component</name>
  <files>src/components/CloudConfigModal.tsx</files>
  <action>
Create simplified config modal - just an enable/disable toggle since credentials are server-side.

Much simpler than S3ConfigModal:
- No form fields for bucket/region/credentials
- Just explanatory text and enable/disable buttons
- Info about how uploads work (presigned URLs, secure)

Props interface:
```typescript
interface CloudConfigModalProps {
  isOpen: boolean;
  onClose: () => void;
  isEnabled: boolean;
  onEnable: () => void;
  onDisable: () => void;
}
```

UI structure:
1. Modal overlay (same pattern as S3ConfigModal)
2. Header: "Cloud Upload Settings"
3. Body:
   - Status indicator (Enabled/Disabled with colored badge)
   - Explanatory text: "Recordings are securely uploaded to cloud storage. Your credentials are never stored in the browser."
   - If enabled: "Uploads will happen automatically when you save recordings"
4. Footer:
   - If disabled: "Enable Cloud Upload" button (blue)
   - If enabled: "Disable Cloud Upload" button (red)
   - Cancel button

Keep same styling patterns as S3ConfigModal (gray-800 bg, rounded-xl, etc.)
  </action>
  <verify>tsc --noEmit passes, component renders without errors</verify>
  <done>
- CloudConfigModal.tsx created with enable/disable UI
- No credential inputs (credentials are server-side)
- Same modal styling as S3ConfigModal
  </done>
</task>

<task type="auto">
  <name>Task 2: Wire cloud upload into CameraPreview and RecordingList</name>
  <files>src/components/CameraPreview.tsx, src/components/RecordingList.tsx</files>
  <action>
Replace S3 integration with cloud upload integration.

In CameraPreview.tsx:
1. Replace `import { useS3Upload }` with `import { useCloudUpload }`
2. Replace `import { S3ConfigModal }` with `import { CloudConfigModal }`
3. Update destructured values:
   - `config` → `config` (still works, different shape)
   - `isConfigured` → `isConfigured` (still works)
   - `saveConfig` → `enableCloud`
   - `clearConfig` → `disableCloud`
   - Rest stays same (uploads, uploadRecording, retryUpload, isUploading)
4. Update CloudConfigModal props to match new interface

In RecordingList.tsx:
1. Update props interface - change S3 props to cloud props:
   - `s3Config` → `cloudEnabled: boolean`
   - `onConfigureS3` → `onConfigureCloud`
   - `s3Uploads` → `uploads` (same type)
   - `onUploadToS3` → `onUploadToCloud`
   - `onRetryS3Upload` → `onRetryUpload`
2. Update "Configure S3" button text to "Cloud Settings"
3. Update disabled state check: `!cloudEnabled` instead of `!s3Config`
4. Update tooltip text from "Configure S3 first" to "Enable cloud upload first"

The upload button UI (progress, states, retry) stays exactly the same - only the wiring changes.
  </action>
  <verify>npm run build succeeds, no TypeScript errors</verify>
  <done>
- CameraPreview uses useCloudUpload and CloudConfigModal
- RecordingList props updated for cloud upload
- All S3 references replaced with cloud equivalents
- Build passes
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Complete cloud upload system replacing S3</what-built>
  <how-to-verify>
    1. Start dev server: `npm run dev`
    2. Visit: http://localhost:5173
    3. Log in with password
    4. Click "Cloud Settings" button (was "Configure S3")
    5. Verify modal shows enable/disable toggle (NOT credential fields)
    6. Enable cloud upload
    7. Make a test recording
    8. In recording history, verify upload button appears
    9. (Note: Actual upload requires R2 setup - just verify UI works)
    10. Disable cloud upload
    11. Verify upload buttons show disabled state
  </how-to-verify>
  <resume-signal>Type "approved" if UI works correctly, or describe issues</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` succeeds without errors
- [ ] CloudConfigModal renders correctly
- [ ] CameraPreview uses cloud upload hook
- [ ] RecordingList shows cloud upload UI
- [ ] Human verified the UI flow
</verification>

<success_criteria>
- CloudConfigModal created with enable/disable toggle
- S3 references completely replaced with cloud equivalents
- Upload UI works (enable/disable, buttons, progress indicators)
- Human verified the complete flow
- Phase 7 complete - ready for Phase 8 (Continuous Recording)
</success_criteria>

<output>
After completion, create `.planning/phases/07-storage-migration/07-03-SUMMARY.md`
</output>
