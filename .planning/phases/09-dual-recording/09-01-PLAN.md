---
phase: 09-dual-recording
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/RecordingControls.tsx
  - src/components/CameraPreview.tsx
autonomous: false
---

<objective>
Add direct cloud upload option for manual recordings, completing the dual recording mode feature.

Purpose: Streamline manual recording workflow by allowing direct upload without going through history. This completes v2.1 milestone with seamless coexistence of manual clips and continuous background recording.

Output: RecordingControls with Upload button, human-verified dual mode UX.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
@~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Phase 8 established patterns
@.planning/phases/08-continuous-recording/08-03-SUMMARY.md

# Source files to modify
@src/components/RecordingControls.tsx
@src/components/CameraPreview.tsx

# Upload infrastructure (already exists)
@src/hooks/useCloudUpload.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add upload button to RecordingControls</name>
  <files>src/components/RecordingControls.tsx, src/components/CameraPreview.tsx</files>
  <action>
1. Add optional props to RecordingControls:
   - `onUpload?: () => void` - callback when user clicks upload
   - `isUploading?: boolean` - show spinner during upload
   - `cloudEnabled?: boolean` - only show upload button if cloud is configured

2. Add Upload button in RecordingControls (between Download and Save):
   - Only render when `state === 'stopped' && recording && cloudEnabled && onUpload`
   - Purple/violet color scheme to distinguish from Download (blue) and Save (green)
   - Cloud upload icon (cloud with up arrow)
   - Show spinner when isUploading is true
   - Disabled state during upload

3. In CameraPreview, wire up the new props:
   - Pass cloudEnabled from useCloudUpload
   - Create handleUploadRecording callback that:
     - Calls uploadRecording from useCloudUpload with current recording
     - Uses existing upload infrastructure (no new hook needed)
   - Track isUploading state locally

4. Button order: Record/Stop | Download | Upload | Save | History
  </action>
  <verify>npm run build succeeds, no TypeScript errors</verify>
  <done>Upload button appears after manual recording when cloud is configured</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Direct upload button for manual recordings, completing dual recording mode</what-built>
  <how-to-verify>
    1. Run: npm run dev
    2. Visit: http://localhost:3000
    3. Enable cloud (click gear icon if not already configured)
    4. Start a manual recording (click record button)
    5. Stop after a few seconds
    6. Verify: Four buttons appear: Download (blue), Upload (purple), Save (green), History (gray)
    7. Click Upload button
    8. Verify: Button shows spinner during upload
    9. Verify: Upload completes (check R2 bucket or network tab)
    10. Test dual mode: Enable continuous recording toggle
    11. Start manual recording while continuous is running
    12. Stop manual recording
    13. Verify: Manual clip upload works independently of continuous background
    14. Verify: Continuous recording indicator (top-left) unaffected by manual actions
  </how-to-verify>
  <resume-signal>Type "approved" if dual recording mode works correctly, or describe any issues</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] npm run build succeeds
- [ ] Upload button renders only when cloud is configured
- [ ] Upload button has distinct color (purple/violet)
- [ ] Spinner shows during upload
- [ ] Manual and continuous recordings work independently
- [ ] Human verified full UX flow
</verification>

<success_criteria>

- All tasks completed
- Manual recordings can be uploaded directly (without save → history → upload)
- Continuous recording operates independently
- Human approved dual recording mode UX
  </success_criteria>

<output>
After completion, create `.planning/phases/09-dual-recording/09-01-SUMMARY.md`
</output>
