---
phase: 11-alert-system
plan: 01
type: execute
wave: 1
depends_on: []
files_modified: [src/types/pose.ts, src/utils/postureRules.ts, src/utils/squatRules.ts, src/utils/pushupRules.ts, src/hooks/useExerciseAlerts.ts]
autonomous: true
---

<objective>
Add body part targeting to alerts so the UI knows which landmarks to highlight.

Purpose: The current alerts return type/message/severity but no information about which body parts have issues. This plan adds `affectedLandmarks` to all alert types so the skeleton overlay can highlight problem areas.

Output: All alert interfaces extended with affectedLandmarks array, all rule functions updated to return landmark indices.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

@src/types/pose.ts
@src/utils/postureRules.ts
@src/utils/squatRules.ts
@src/utils/pushupRules.ts
@src/hooks/useExerciseAlerts.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add affectedLandmarks to all alert interfaces</name>
  <files>src/utils/postureRules.ts, src/utils/squatRules.ts, src/utils/pushupRules.ts</files>
  <action>
1. In postureRules.ts, update PostureAlert interface:
   ```typescript
   export interface PostureAlert {
     type: string;
     message: string;
     severity: 'warning' | 'error';
     affectedLandmarks: number[]; // Landmark indices to highlight
   }
   ```

2. In squatRules.ts, update SquatFormAlert interface:
   ```typescript
   export interface SquatFormAlert {
     type: 'squat-depth' | 'squat-knee-cave' | 'squat-forward-lean' | 'squat-asymmetric';
     message: string;
     severity: 'warning' | 'error';
     affectedLandmarks: number[];
   }
   ```

3. In pushupRules.ts, update PushupFormAlert interface similarly.

4. Update checkGeneralPosture() to return affectedLandmarks for each alert type:
   - 'visibility': empty array (no specific landmarks)
   - 'uneven': [LEFT_SHOULDER, RIGHT_SHOULDER]
   - 'twisted': [LEFT_SHOULDER, RIGHT_SHOULDER, LEFT_HIP, RIGHT_HIP]
   - 'leaning': [NOSE, LEFT_SHOULDER, RIGHT_SHOULDER]

5. Update checkSquatForm() to return affectedLandmarks:
   - 'squat-asymmetric': [LEFT_HIP, LEFT_KNEE, LEFT_ANKLE, RIGHT_HIP, RIGHT_KNEE, RIGHT_ANKLE]
   - 'squat-depth': [LEFT_HIP, LEFT_KNEE, RIGHT_HIP, RIGHT_KNEE]
   - 'squat-knee-cave': [LEFT_KNEE, RIGHT_KNEE, LEFT_ANKLE, RIGHT_ANKLE]
   - 'squat-forward-lean': [LEFT_SHOULDER, RIGHT_SHOULDER, LEFT_HIP, RIGHT_HIP]

6. Update checkPushupForm() similarly with appropriate landmarks for each alert type.
  </action>
  <verify>npm run build succeeds, no TypeScript errors</verify>
  <done>All alert interfaces include affectedLandmarks, all check functions return landmark arrays</done>
</task>

<task type="auto">
  <name>Task 2: Update useExerciseAlerts to expose affectedLandmarks</name>
  <files>src/hooks/useExerciseAlerts.ts</files>
  <action>
1. The ExerciseAlert union type already includes the updated interfaces, so no change needed there.

2. Add affectedLandmarks to the return type. Update UseExerciseAlertsReturn:
   ```typescript
   interface UseExerciseAlertsReturn {
     currentAlert: ExerciseAlert | null;
     affectedLandmarks: number[]; // Convenience accessor
     playAlertSound: () => void;
     isExercising: boolean;
   }
   ```

3. Add a derived value that extracts affectedLandmarks from currentAlert:
   ```typescript
   const affectedLandmarks = currentAlert?.affectedLandmarks ?? [];
   ```

4. Return affectedLandmarks in the hook's return object.

This allows consumers to easily access the landmarks without null-checking the alert.
  </action>
  <verify>npm run build succeeds, no TypeScript errors</verify>
  <done>Hook exposes affectedLandmarks array, ready for PoseCanvas consumption</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] npm run build succeeds without errors
- [ ] All alert interfaces have affectedLandmarks: number[]
- [ ] All check* functions return alerts with populated affectedLandmarks
- [ ] useExerciseAlerts exposes affectedLandmarks in return value
</verification>

<success_criteria>
- All tasks completed
- Alert system now provides body part targeting information
- No breaking changes to existing alert consumers (they can ignore affectedLandmarks)
- Ready for Plan 02 to use affectedLandmarks in skeleton rendering
</success_criteria>

<output>
After completion, create `.planning/phases/11-alert-system/11-01-SUMMARY.md`
</output>
