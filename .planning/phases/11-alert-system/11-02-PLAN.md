---
phase: 11-alert-system
plan: 02
type: execute
wave: 2
depends_on: ["11-01"]
files_modified: [src/components/PoseCanvas.tsx, src/components/AlertOverlay.tsx, src/components/CameraPreview.tsx]
autonomous: false
---

<objective>
Implement severity-based skeleton highlighting and improved alert visibility.

Purpose: Users need clearer visual feedback during exercise. This plan:
1. Highlights problem body parts on the skeleton (red/yellow based on severity)
2. Color-codes the alert banner by severity
3. Ensures alerts are visible during fullscreen workouts

Output: Skeleton shows highlighted landmarks when alerts are active, alert banner uses severity colors.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
@~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/11-alert-system/11-01-SUMMARY.md

@src/components/PoseCanvas.tsx
@src/components/AlertOverlay.tsx
@src/components/CameraPreview.tsx
@src/hooks/useExerciseAlerts.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add severity-based landmark highlighting to PoseCanvas</name>
  <files>src/components/PoseCanvas.tsx</files>
  <action>
1. Update PoseCanvasProps to accept highlight data:
   ```typescript
   interface PoseCanvasProps {
     landmarks: Landmark[] | null;
     width: number;
     height: number;
     highlightLandmarks?: number[]; // Landmark indices to highlight
     highlightSeverity?: 'warning' | 'error'; // Color to use
   }
   ```

2. Add highlight colors as constants:
   ```typescript
   const HIGHLIGHT_WARNING_COLOR = '#FFCC00'; // Yellow for warnings
   const HIGHLIGHT_ERROR_COLOR = '#FF3333'; // Red for errors
   const HIGHLIGHT_RADIUS = 8; // Larger than normal landmarks
   const HIGHLIGHT_LINE_WIDTH = 4; // Thicker connections
   ```

3. In the useEffect draw loop, after drawing normal landmarks:
   - If highlightLandmarks is provided and not empty:
   - Determine highlight color based on highlightSeverity (default to error color)
   - Draw highlighted landmarks with larger radius and highlight color
   - Draw connections involving highlighted landmarks with thicker lines and highlight color
   - Add a subtle glow effect: draw a slightly larger, semi-transparent circle behind highlighted landmarks

4. The highlight should be drawn ON TOP of normal skeleton (so it visually pops).
  </action>
  <verify>npm run build succeeds, no TypeScript errors</verify>
  <done>PoseCanvas accepts and renders highlighted landmarks with severity-based colors</done>
</task>

<task type="auto">
  <name>Task 2: Update AlertOverlay with severity-based colors</name>
  <files>src/components/AlertOverlay.tsx</files>
  <action>
1. Update AlertOverlayProps to include severity:
   ```typescript
   interface AlertOverlayProps {
     alert: ExerciseAlert | null;
   }
   ```
   (ExerciseAlert already has severity, so we can access it directly)

2. Update the border and banner colors based on alert.severity:
   - warning: yellow border (border-yellow-400), yellow/orange banner (bg-yellow-500/90)
   - error: red border (border-red-500), red banner (bg-red-600/90) - current behavior

3. Update the CSS classes dynamically:
   ```typescript
   const borderColor = alert.severity === 'error' ? 'border-red-500' : 'border-yellow-400';
   const bannerBg = alert.severity === 'error' ? 'bg-red-600/90' : 'bg-yellow-500/90';
   const textColor = alert.severity === 'error' ? 'text-white' : 'text-gray-900';
   ```

4. Keep the animate-pulse on the border for both severities.
  </action>
  <verify>npm run build succeeds, no TypeScript errors</verify>
  <done>Alert overlay shows yellow for warnings, red for errors</done>
</task>

<task type="auto">
  <name>Task 3: Wire up highlighting in CameraPreview</name>
  <files>src/components/CameraPreview.tsx</files>
  <action>
1. Get affectedLandmarks from useExerciseAlerts:
   ```typescript
   const { currentAlert, affectedLandmarks, isExercising } = useExerciseAlerts(landmarks, exerciseMode);
   ```

2. Pass highlight props to PoseCanvas:
   ```typescript
   <PoseCanvas
     landmarks={landmarks}
     width={videoDimensions.width}
     height={videoDimensions.height}
     highlightLandmarks={affectedLandmarks}
     highlightSeverity={currentAlert?.severity}
   />
   ```

3. No other changes needed - AlertOverlay already receives the full alert object.
  </action>
  <verify>npm run build succeeds, no TypeScript errors</verify>
  <done>CameraPreview passes highlight data to PoseCanvas</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Severity-based skeleton highlighting and color-coded alerts</what-built>
  <how-to-verify>
    1. Run: npm run dev
    2. Open in browser, allow camera access

    Test warning alerts (yellow):
    3. Select "General" mode
    4. Tilt head or lean significantly to trigger "Leaning too far" warning
    5. Verify: Yellow border pulses, yellow banner with dark text
    6. Verify: Affected landmarks (shoulders, nose) glow yellow on skeleton

    Test error alerts (red):
    7. Select "Squat" mode
    8. Perform a squat with knees caving inward
    9. Verify: Red border pulses, red banner with white text
    10. Verify: Knee/ankle landmarks glow red on skeleton

    Test in fullscreen:
    11. Click fullscreen button
    12. Trigger an alert - verify it's still clearly visible
    13. Rotate device (if mobile) - verify alert positioning
  </how-to-verify>
  <resume-signal>Type "approved" to continue, or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] npm run build succeeds without errors
- [ ] PoseCanvas highlights landmarks based on affectedLandmarks prop
- [ ] AlertOverlay shows yellow for warnings, red for errors
- [ ] CameraPreview wires everything together correctly
- [ ] Human verified both warning and error severity visuals
</verification>

<success_criteria>
- All tasks completed
- Skeleton highlights problem areas with appropriate colors
- Alert banner color matches severity
- Both severities tested and visually verified
- Works correctly in fullscreen mode
</success_criteria>

<output>
After completion, create `.planning/phases/11-alert-system/11-02-SUMMARY.md`
</output>
