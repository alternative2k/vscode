---
phase: 12-auto-start-recording
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/hooks/useContinuousRecording.ts
  - src/components/CameraPreview.tsx
autonomous: true
---

<objective>
Auto-start continuous recording when camera stream becomes available, auto-stop on unmount/stream loss.

Purpose: Seamless recording experience - user opens app, recording starts automatically without any manual interaction.
Output: Continuous recording starts automatically when camera loads, stops cleanly on page exit.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

@src/hooks/useContinuousRecording.ts
@src/components/CameraPreview.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add autoStart option to useContinuousRecording hook</name>
  <files>src/hooks/useContinuousRecording.ts</files>
  <action>
Add an `autoStart?: boolean` option to the hook's parameters. When `autoStart` is true:
1. Instead of requiring `enable()` to be called, automatically set `isEnabled` to true on mount
2. Modify the existing effect that watches `isEnabled && stream && state === 'idle'` to trigger automatically when stream becomes available
3. Keep the existing `enable()` and `disable()` functions for manual override if needed later (don't remove them)

The hook signature changes from:
```typescript
export function useContinuousRecording(stream: MediaStream | null): UseContinuousRecordingReturn
```
to:
```typescript
interface UseContinuousRecordingOptions {
  autoStart?: boolean;
}
export function useContinuousRecording(
  stream: MediaStream | null,
  options?: UseContinuousRecordingOptions
): UseContinuousRecordingReturn
```

Add a useEffect that sets `isEnabled` to true on mount when `autoStart` is true:
```typescript
useEffect(() => {
  if (options?.autoStart) {
    setIsEnabled(true);
  }
}, [options?.autoStart]);
```

This leverages the existing auto-start logic: `if (isEnabled && stream && state === 'idle') { startRecording(); }`
  </action>
  <verify>tsc --noEmit passes, hook still exports same return type</verify>
  <done>Hook accepts autoStart option, recording starts automatically when stream available and autoStart is true</done>
</task>

<task type="auto">
  <name>Task 2: Enable autoStart in CameraPreview and remove toggle button</name>
  <files>src/components/CameraPreview.tsx</files>
  <action>
1. Change useContinuousRecording call to pass `{ autoStart: true }`:
   ```typescript
   const {
     state: continuousState,
     isEnabled: continuousEnabled,
     duration: continuousDuration,
     chunkCount,
     uploadProgress,
     enable: enableContinuous,
     disable: disableContinuous,
     error: continuousError,
   } = useContinuousRecording(stream, { autoStart: true });
   ```

2. Remove the continuous recording toggle button from the top-left status area (lines 375-426 approximately). This includes:
   - The `<button>` element with `onClick={continuousEnabled ? disableContinuous : enableContinuous}`
   - The associated status indicator divs
   - The continuous error display div

   Keep the tracking status indicator and skeleton toggle button - only remove the continuous recording toggle.

3. Keep the imports for `enable` and `disable` even though they're not used in the UI - they're still available for programmatic control if needed. (Or remove them to keep code clean - either is fine, just be consistent.)

Note: The status indicator UI will be re-added in Phase 13 as a read-only indicator. For now, continuous recording just works silently in the background.
  </action>
  <verify>npm run build succeeds, app loads and continuous recording starts automatically when camera loads</verify>
  <done>Continuous recording auto-starts when CameraPreview mounts with stream, toggle button removed from UI</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` succeeds without errors
- [ ] `npm run dev` starts, camera loads, and continuous recording begins automatically (check console for chunk saves)
- [ ] No toggle button visible in top-left area for continuous recording
- [ ] Tracking indicator and skeleton toggle still work
- [ ] Page exit (close tab, navigate away) triggers upload of pending chunks
- [ ] Manual recording still works independently
</verification>

<success_criteria>

- Continuous recording starts automatically when camera stream available
- No manual toggle button needed to start recording
- Existing visibilitychange handling still works for page exit
- Manual recording functionality unaffected
- Build passes with no TypeScript errors
</success_criteria>

<output>
After completion, create `.planning/phases/12-auto-start-recording/12-01-SUMMARY.md`
</output>
