---
phase: 15-user-access-control
plan: 01
type: execute
wave: 1
depends_on: []
files_modified: [src/types/auth.ts, src/hooks/useAuth.ts, src/components/PasswordGate.tsx, src/App.tsx, .env.example]
autonomous: true
---

<objective>
Replace single shared password with multi-user authentication system supporting user identity (id, name, password, isAdmin role).

Purpose: Enable individual user identification for future features (user folders in Phase 17, admin app lock in Phase 16) while maintaining the simple password-based auth model.
Output: Multi-user auth system where each user has a unique ID, name, and admin flag.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/15-user-access-control/15-RESEARCH.md

@src/hooks/useAuth.ts
@src/components/PasswordGate.tsx
@src/App.tsx
@.env.example
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create auth types and update useAuth hook</name>
  <files>src/types/auth.ts, src/hooks/useAuth.ts</files>
  <action>
1. Create `src/types/auth.ts` with:
   ```typescript
   export interface User {
     id: string;        // Unique ID for folder paths: "sean", "guest1"
     name: string;      // Display name: "Sean"
     password: string;  // Login password
     isAdmin: boolean;  // Can toggle lock, immune to lock
   }

   export interface AuthState {
     user: User | null;
     isAuthed: boolean;
   }
   ```

2. Update `src/hooks/useAuth.ts`:
   - Parse `VITE_USERS` env var as JSON array of User objects
   - Fallback to single user from `VITE_APP_PASSWORD` for backward compatibility:
     ```typescript
     const fallbackUser: User = {
       id: 'default',
       name: 'User',
       password: import.meta.env.VITE_APP_PASSWORD || 'formcheck2024',
       isAdmin: true
     };
     ```
   - Change `login(password: string)` to find matching user by password
   - Store full user object in localStorage (JSON serialized) instead of just 'true'
   - Return `{ isAuthed, user, login, logout }` where `user` is `User | null`
   - Add `getUsers()` helper to parse env var safely

Key pattern: Check VITE_USERS first, fall back to VITE_APP_PASSWORD for backward compatibility.
  </action>
  <verify>TypeScript compiles: `npx tsc --noEmit`</verify>
  <done>
- User type exported from src/types/auth.ts
- useAuth returns user object with id, name, isAdmin
- Backward compatible with VITE_APP_PASSWORD
- localStorage stores user object
  </done>
</task>

<task type="auto">
  <name>Task 2: Update PasswordGate for user login</name>
  <files>src/components/PasswordGate.tsx</files>
  <action>
Update `src/components/PasswordGate.tsx`:
- Change `onLogin` prop type from `(password: string) => boolean` to `(password: string) => User | null`
- On successful login, component unmounts (parent handles state)
- On failed login, show "Incorrect password" error (same as current)
- Keep existing UI styling and behavior

No need to show which user logged in on the gate itself - that will show in App header after login.
  </action>
  <verify>TypeScript compiles: `npx tsc --noEmit`</verify>
  <done>
- PasswordGate accepts updated onLogin signature
- Login flow works with user identification
- Error handling unchanged
  </done>
</task>

<task type="auto">
  <name>Task 3: Update App to display user info and update .env.example</name>
  <files>src/App.tsx, .env.example</files>
  <action>
1. Update `src/App.tsx`:
   - Get `user` from useAuth hook
   - Display user name in header next to logout button (small text)
   - Show admin badge if user.isAdmin is true
   - Example: "Sean (Admin) | Logout" or "Guest1 | Logout"
   - Use subtle styling: `text-gray-400 text-xs` for the name

2. Update `.env.example`:
   - Add VITE_USERS example configuration
   - Document the JSON array format
   - Keep VITE_APP_PASSWORD as fallback option
   ```
   # Multi-user configuration (JSON array)
   # Each user needs: id (for folders), name (display), password, isAdmin
   VITE_USERS='[{"id":"sean","name":"Sean","password":"sean2024","isAdmin":true},{"id":"guest1","name":"Guest","password":"guest123","isAdmin":false}]'

   # Single-user fallback (used if VITE_USERS not set)
   VITE_APP_PASSWORD=your-secure-password-here
   ```
  </action>
  <verify>
- `npm run build` succeeds
- Dev server starts and shows login gate
- After login, header shows user name
  </verify>
  <done>
- App header displays logged-in user name
- Admin badge visible for admin users
- .env.example documents VITE_USERS format
- Both single-user and multi-user configs work
  </done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npx tsc --noEmit` passes (no TypeScript errors)
- [ ] `npm run build` succeeds
- [ ] App loads with password gate
- [ ] Login with correct password shows user name in header
- [ ] Admin users show "(Admin)" badge
- [ ] Logout works correctly
- [ ] Backward compatibility: VITE_APP_PASSWORD still works if VITE_USERS not set
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- Multi-user auth system functional
- User identity (id, name, isAdmin) available throughout app
- Phase 16 can access user.isAdmin for lock toggle
- Phase 17 can access user.id for cloud folder paths
</success_criteria>

<output>
After completion, create `.planning/phases/15-user-access-control/15-01-SUMMARY.md`
</output>
